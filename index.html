<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Lyc√©e fran√ßais de Tananarive, Madagascar ‚Äì Suivi des projets</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        :root {
            --primary: #2563eb;
            --primary-light: #dbeafe;
            --accent: #f97316;
            --bg: #f3f4f6;
            --card-bg: #ffffff;
            --text-main: #111827;
            --text-muted: #6b7280;
            --border: #e5e7eb;
            --radius-lg: 16px;
            --radius-md: 12px;
            --shadow-soft: 0 10px 25px rgba(15, 23, 42, 0.12);
        }

        * { box-sizing: border-box; }

        body {
            margin: 0;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background: linear-gradient(135deg, #eff6ff, #f9fafb);
            color: var(--text-main);
        }

        header {
            background: linear-gradient(120deg, #1d4ed8, #0ea5e9);
            color: white;
            padding: 0.75rem 1rem;
            box-shadow: 0 4px 20px rgba(15, 23, 42, 0.3);
        }

        .header-inner {
            max-width: 1120px;
            margin: 0 auto;
        }

        .header-main {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
        }

        .header-text {
            display: flex;
            flex-direction: column;
            gap: 0.35rem;
        }

        h1 {
            margin: 0;
            font-size: clamp(1.6rem, 3vw, 2.2rem);
            font-weight: 700;
            letter-spacing: 0.03em;
        }

        .subtitle {
            margin: 0;
            font-size: 0.95rem;
            opacity: 0.9;
        }

        .header-logo {
            max-width: 140px;
            height: auto;
        }

        main {
            max-width: 1120px;
            margin: 1.5rem auto 2.5rem;
            padding: 0 1rem;
        }

        .page-section {
            display: none;
            animation: fadeIn 0.2s ease-out;
        }

        .page-section.active {
            display: block;
        }

        .card {
            background: var(--card-bg);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            box-shadow: var(--shadow-soft);
            border: 1px solid rgba(148, 163, 184, 0.2);
        }

        .page-title {
            margin-top: 0;
            font-size: 1.4rem;
            display: flex;
            align-items: center;
            gap: 0.6rem;
        }

        .page-title span.icon {
            font-size: 1.4rem;
        }

        .intro-text {
            margin-top: 0.5rem;
            color: var(--text-muted);
            line-height: 1.6;
        }

        .grid-buttons {
            margin-top: 1.5rem;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 1rem;
        }

        .big-button {
            border: none;
            border-radius: var(--radius-lg);
            padding: 1.1rem 1rem;
            background: white;
            box-shadow: 0 8px 20px rgba(15, 23, 42, 0.08);
            border: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 0.35rem;
            cursor: pointer;
            text-align: left;
            transition: transform 0.12s ease, box-shadow 0.12s ease,
                        border 0.12s ease, background 0.12s ease;
        }

        .big-button-main {
            background: linear-gradient(135deg, var(--primary), #4f46e5);
            color: white;
            border-color: rgba(255, 255, 255, 0.4);
        }

        .big-button-main .btn-label {
            color: rgba(243, 244, 246, 0.9);
        }

        .big-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 14px 30px rgba(15, 23, 42, 0.18);
            border-color: var(--primary);
            background: var(--primary-light);
        }

        .big-button-main:hover {
            border-color: white;
            background: linear-gradient(135deg, #1d4ed8, #7c3aed);
        }

        .btn-title {
            font-weight: 600;
            font-size: 1rem;
        }

        .btn-label {
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        .tag {
            font-size: 0.75rem;
            padding: 0.1rem 0.5rem;
            border-radius: 999px;
            background: rgba(59, 130, 246, 0.12);
            color: #1d4ed8;
        }

        .section-header {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: flex-start;
            gap: 1rem;
            margin-bottom: 1.2rem;
        }

        .badge {
            display: inline-flex;
            align-items: center;
            gap: 0.35rem;
            font-size: 0.8rem;
            padding: 0.25rem 0.6rem;
            border-radius: 999px;
            background: rgba(236, 72, 153, 0.08);
            color: #be185d;
        }

        .toolbar {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            align-items: center;
            margin-bottom: 1rem;
        }

        .btn {
            border: none;
            border-radius: 999px;
            padding: 0.45rem 0.95rem;
            font-size: 0.85rem;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
            transition: transform 0.1s ease, box-shadow 0.1s ease, background 0.1s ease;
        }

        .btn-primary {
            background: #2563eb;
            color: white;
            box-shadow: 0 6px 14px rgba(37, 99, 235, 0.4);
        }

        .btn-primary:hover {
            background: #1d4ed8;
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: #e5e7eb;
            color: #111827;
        }

        .btn-secondary:hover {
            background: #d1d5db;
            transform: translateY(-1px);
        }

        .btn-ghost {
            background: transparent;
            border: 1px solid var(--border);
        }

        .btn-ghost:hover {
            background: #f3f4f6;
        }

        .btn-small {
            padding: 0.3rem 0.7rem;
            font-size: 0.8rem;
        }

        .btn-danger {
            border-color: #fecaca;
            color: #b91c1c;
            padding: 0.2rem 0.45rem;
            font-size: 0.75rem;
        }

        .btn-danger:hover {
            background: #fee2e2;
        }

        .table-wrapper {
            margin-top: 1rem;
            border-radius: var(--radius-md);
            border: 1px solid var(--border);
            background: #f9fafb;
            padding: 0.5rem;
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 500px;
            font-size: 0.85rem;
        }

        th, td {
            border: 1px solid var(--border);
            padding: 0.45rem 0.5rem;
            vertical-align: top;
        }

        th {
            background: #eff6ff;
            text-align: left;
            font-weight: 600;
        }

        td[contenteditable="true"] {
            background: white;
            cursor: text;
        }

        td:first-child {
            white-space: nowrap;
        }

        .section-actions {
            margin-top: 1.4rem;
            display: flex;
            flex-wrap: wrap;
            gap: 0.6rem;
            align-items: center;
        }

        footer {
            padding: 1rem 1.2rem 1.5rem;
            background: #0f172a;
            color: #e5e7eb;
            font-size: 0.8rem;
            margin-top: 2rem;
        }

        .footer-inner {
            max-width: 1120px;
            margin: 0 auto;
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            gap: 0.75rem;
            align-items: center;
        }

        .months-grid {
            margin-top: 1.2rem;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 0.75rem;
        }

        .month-button {
            border: none;
            border-radius: 999px;
            padding: 0.6rem 0.8rem;
            background: white;
            box-shadow: 0 4px 10px rgba(15, 23, 42, 0.06);
            border: 1px solid var(--border);
            cursor: pointer;
            font-size: 0.9rem;
            text-align: center;
            transition: transform 0.1s ease, box-shadow 0.1s ease, background 0.1s ease;
        }

        .month-button:hover {
            background: var(--primary-light);
            transform: translateY(-1px);
            box-shadow: 0 8px 18px rgba(15, 23, 42, 0.12);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(4px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @media (max-width: 640px) {
            header { padding: 0.7rem 0.9rem; }
            .card { padding: 1.1rem 1rem; }
            .section-header { flex-direction: column; }
            .header-main { flex-direction: column; align-items: flex-start; }
            .header-logo { max-width: 160px; }
        }
    </style>
</head>
<body>
<header>
    <div class="header-inner">
        <div class="header-main">
            <div class="header-text">
                <h1>Lyc√©e fran√ßais de Tananarive, Madagascar</h1>
                <p class="subtitle">
                    Tableau de bord ‚Äì Suivi des projets (LFT, AEFE, Zone Oc√©an Indien, projets institutionnels)
                </p>
            </div>
            <img src="LogoLFT.png" alt="Lyc√©e Fran√ßais de Tananarive - AEFE" class="header-logo">
        </div>
    </div>
</header>

<main>
    <!-- ACCUEIL -->
    <section id="accueil" class="page-section active">
        <div class="card">
            <h2 class="page-title">
                <span class="icon">üìå</span>
                Tableau de bord ‚Äì Suivi des projets du LFT
            </h2>
            <p class="intro-text">
                Cet outil permet de recenser et de suivre les projets port√©s par le Lyc√©e Fran√ßais de Tananarive,
                en lien avec la zone Oc√©an Indien, l‚ÄôAEFE et les priorit√©s institutionnelles. Utilise les boutons
                ci-dessous pour acc√©der aux diff√©rentes vues.
            </p>

            <div class="grid-buttons">
                <!-- 1. Suivi des projets mois par mois -->
                <button class="big-button big-button-main" type="button" onclick="afficherSection('projets-mois')">
                    <span class="tag">Vue chronologique</span>
                    <span class="btn-title">Suivi des projets mois par mois</span>
                    <span class="btn-label">Visualiser les projets de l‚Äô√©tablissement organis√©s par mois (ann√©e scolaire).</span>
                </button>

                <!-- 2. Projets LFT -->
                <button class="big-button" type="button" onclick="afficherSection('lft')">
                    <span class="tag">Interne LFT</span>
                    <span class="btn-title">Projets LFT</span>
                    <span class="btn-label">Lister les projets port√©s en interne par les √©quipes du lyc√©e.</span>
                </button>

                <!-- 3. Projets Zone Oc√©an Indien -->
                <button class="big-button" type="button" onclick="afficherSection('zoi')">
                    <span class="tag">Coop√©rations de zone</span>
                    <span class="btn-title">Projets Zone Oc√©an Indien</span>
                    <span class="btn-label">Cartographier les projets de la zone et les partenariats inter-√©tablissements.</span>
                </button>

                <!-- 4. Projets AEFE -->
                <button class="big-button" type="button" onclick="afficherSection('aefe')">
                    <span class="tag">R√©seau AEFE</span>
                    <span class="btn-title">Projets AEFE</span>
                    <span class="btn-label">Suivre les projets en lien direct avec les orientations de l‚ÄôAEFE.</span>
                </button>

                <!-- 5. Projets institutionnels -->
                <button class="big-button" type="button" onclick="afficherSection('inst')">
                    <span class="tag">Cadre institutionnel</span>
                    <span class="btn-title">Projets institutionnels</span>
                    <span class="btn-label">Suivre les projets li√©s aux axes institutionnels et au projet d‚Äô√©tablissement.</span>
                </button>

                <!-- 6. Projet d‚Äô√©tablissement -->
                <button class="big-button" type="button" onclick="afficherSection('projet-etab')">
                    <span class="tag">R√©f√©rence strat√©gique</span>
                    <span class="btn-title">Projet d‚Äô√©tablissement</span>
                    <span class="btn-label">Acc√©der au projet d‚Äô√©tablissement (Genially, document, etc.).</span>
                </button>

                <!-- 7. Tuto fiche projet -->
                <button class="big-button" type="button" onclick="afficherSection('tuto-fiche')">
                    <span class="tag">Accompagnement</span>
                    <span class="btn-title">Tuto fiche projet</span>
                    <span class="btn-label">Lien vers un tutoriel expliquant comment remplir la fiche projet.</span>
                </button>
            </div>
        </div>
    </section>

    <!-- PROJETS MOIS PAR MOIS : CHOIX DU MOIS -->
    <section id="projets-mois" class="page-section">
        <div class="card">
            <div class="section-header">
                <div>
                    <h2 class="page-title">
                        <span class="icon">üóìÔ∏è</span>
                        Suivi des projets mois par mois
                    </h2>
                    <p class="intro-text">
                        Ann√©e scolaire de septembre √† juin. Choisis un mois pour acc√©der √† une page param√©trable
                        o√π tu pourras saisir les projets connus pour ce mois (pr√©visionnels et r√©alis√©s).
                    </p>
                </div>
                <div class="badge">
                    <span>Vue chronologique</span>
                </div>
            </div>

            <div class="months-grid">
                <button class="month-button" type="button" onclick="ouvrirMois('Septembre')">Septembre</button>
                <button class="month-button" type="button" onclick="ouvrirMois('Octobre')">Octobre</button>
                <button class="month-button" type="button" onclick="ouvrirMois('Novembre')">Novembre</button>
                <button class="month-button" type="button" onclick="ouvrirMois('D√©cembre')">D√©cembre</button>
                <button class="month-button" type="button" onclick="ouvrirMois('Janvier')">Janvier</button>
                <button class="month-button" type="button" onclick="ouvrirMois('F√©vrier')">F√©vrier</button>
                <button class="month-button" type="button" onclick="ouvrirMois('Mars')">Mars</button>
                <button class="month-button" type="button" onclick="ouvrirMois('Avril')">Avril</button>
                <button class="month-button" type="button" onclick="ouvrirMois('Mai')">Mai</button>
                <button class="month-button" type="button" onclick="ouvrirMois('Juin')">Juin</button>
            </div>

            <div class="section-actions">
                <button type="button" class="btn btn-secondary btn-small" onclick="afficherSection('accueil')">
                    ‚¨Ö Retour √† l‚Äôaccueil
                </button>
            </div>
        </div>
    </section>

    <!-- DETAIL D'UN MOIS -->
    <section id="mois-detail" class="page-section">
        <div class="card">
            <div class="section-header">
                <div>
                    <h2 class="page-title">
                        <span class="icon">üìÖ</span>
                        Projets du mois de <span id="moisTitre">‚Äî</span>
                    </h2>
                    <p class="intro-text">
                        Saisis ici les projets connus pour ce mois : projets pr√©vus, actions r√©alis√©es, temps forts, etc.
                        Le tableau est enti√®rement param√©trable : tu peux ajouter des lignes et modifier le contenu librement.
                    </p>
                </div>
                <div class="badge">
                    <span>Mois s√©lectionn√©</span>
                </div>
            </div>

            <div class="toolbar">
                <button type="button" class="btn btn-primary" onclick="ajouterLigneMoisDetail()">
                    ‚ûï Ajouter une ligne
                </button>
                <button type="button" class="btn btn-secondary" onclick="afficherSection('projets-mois')">
                    ‚¨Ö Retour mois par mois
                </button>
                <button type="button" class="btn btn-ghost btn-small" onclick="afficherSection('accueil')">
                    üè† Retour √† l‚Äôaccueil
                </button>
            </div>

            <div class="table-wrapper">
                <table id="table-mois-detail">
                    <thead>
                    <tr>
                        <th>Projets du mois</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td contenteditable="true"></td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </section>

    <!-- PROJETS LFT - PRINCIPAL -->
    <section id="lft" class="page-section">
        <div class="card">
            <div class="section-header">
                <div>
                    <h2 class="page-title">
                        <span class="icon">üè´</span>
                        Projets Lyc√©e Fran√ßais de Tananarive (LFT)
                    </h2>
                    <p class="intro-text">
                        Cette section centralise les projets internes port√©s par les √©quipes du LFT : projets disciplinaires,
                        inter-cycles, √©v√©nements d‚Äô√©tablissement, dispositifs d‚Äôaccompagnement, etc.
                    </p>
                </div>
                <div class="badge">
                    <span>Interne √©tablissement</span>
                </div>
            </div>

            <div class="section-actions">
                <button type="button" class="btn btn-primary" onclick="afficherSection('lft-liste')">
                    üìã Voir / saisir les projets LFT
                </button>
            </div>

            <div class="section-actions">
                <button type="button" class="btn btn-secondary" onclick="afficherSection('accueil')">
                    üè† Retour √† l‚Äôaccueil
                </button>
            </div>
        </div>
    </section>

    <!-- PROJETS LFT - LISTE (10 LIGNES PR√âVUES) -->
    <section id="lft-liste" class="page-section">
        <div class="card">
            <div class="section-header">
                <div>
                    <h2 class="page-title">
                        <span class="icon">üìã</span>
                        Liste des projets LFT
                    </h2>
                    <p class="intro-text">
                        Renseigne ici les projets port√©s en interne par le LFT. Chaque ligne dispose d‚Äôune fiche projet vierge,
                        d‚Äôun lien d‚Äôinformation et d‚Äôun lien d‚Äôhistorique, tous param√©trables et modifiables.
                    </p>
                </div>
            </div>

            <div class="toolbar">
                <button type="button" class="btn btn-primary" onclick="ajouterLigneGenerique('table-lft')">
                    ‚ûï Ajouter une ligne
                </button>
                <button type="button" class="btn btn-secondary" onclick="afficherSection('lft')">
                    ‚¨Ö Retour Projets LFT
                </button>
                <button type="button" class="btn btn-ghost btn-small" onclick="afficherSection('accueil')">
                    üè† Retour √† l‚Äôaccueil
                </button>
            </div>

            <div class="table-wrapper">
                <table id="table-lft">
                    <thead>
                    <tr>
                        <th>Intitul√© du projet LFT</th>
                        <th>Fiche projet vierge</th>
                        <th>Info projet</th>
                        <th>Historique</th>
                    </tr>
                    </thead>
                    <tbody>
                    <!-- 10 lignes remplissables au d√©part -->
                    <!-- Ligne 1 -->
                    <tr>
                        <td contenteditable="true"></td>
                        <td>
                            <button type="button" class="btn btn-small btn-primary" onclick="ouvrirFicheProjet(this)">
                                Fiche projet vierge
                            </button>
                            <button type="button" class="btn btn-small btn-danger" title="Supprimer le lien"
                                    onclick="supprimerLien(this)">‚úï</button>
                        </td>
                        <td>
                            <button type="button" class="btn btn-small btn-secondary" onclick="ouvrirInfoProjet(this)">
                                Info projet
                            </button>
                            <button type="button" class="btn btn-small btn-danger" title="Supprimer le lien"
                                    onclick="supprimerLien(this)">‚úï</button>
                        </td>
                        <td>
                            <button type="button" class="btn btn-small btn-ghost" onclick="ouvrirHistoriqueProjet(this)">
                                Historique
                            </button>
                            <button type="button" class="btn btn-small btn-danger" title="Supprimer le lien"
                                    onclick="supprimerLien(this)">‚úï</button>
                        </td>
                    </tr>
                    <!-- Lignes 2 √† 10 (copie du m√™me mod√®le, vides) -->
                    <tr>
                        <td contenteditable="true"></td>
                        <td>
                            <button type="button" class="btn btn-small btn-primary" onclick="ouvrirFicheProjet(this)">
                                Fiche projet vierge
                            </button>
                            <button type="button" class="btn btn-small btn-danger" title="Supprimer le lien"
                                    onclick="supprimerLien(this)">‚úï</button>
                        </td>
                        <td>
                            <button type="button" class="btn btn-small btn-secondary" onclick="ouvrirInfoProjet(this)">
                                Info projet
                            </button>
                            <button type="button" class="btn btn-small btn-danger" title="Supprimer le lien"
                                    onclick="supprimerLien(this)">‚úï</button>
                        </td>
                        <td>
                            <button type="button" class="btn btn-small btn-ghost" onclick="ouvrirHistoriqueProjet(this)">
                                Historique
                            </button>
                            <button type="button" class="btn btn-small btn-danger" title="Supprimer le lien"
                                    onclick="supprimerLien(this)">‚úï</button>
                        </td>
                    </tr>
                    <tr>
                        <td contenteditable="true"></td>
                        <td>
                            <button type="button" class="btn btn-small btn-primary" onclick="ouvrirFicheProjet(this)">
                                Fiche projet vierge
                            </button>
                            <button type="button" class="btn btn-small btn-danger" title="Supprimer le lien"
                                    onclick="supprimerLien(this)">‚úï</button>
                        </td>
                        <td>
                            <button type="button" class="btn btn-small btn-secondary" onclick="ouvrirInfoProjet(this)">
                                Info projet
                            </button>
                            <button type="button" class="btn btn-small btn-danger" title="Supprimer le lien"
                                    onclick="supprimerLien(this)">‚úï</button>
                        </td>
                        <td>
                            <button type="button" class="btn btn-small btn-ghost" onclick="ouvrirHistoriqueProjet(this)">
                                Historique
                            </button>
                            <button type="button" class="btn btn-small btn-danger" title="Supprimer le lien"
                                    onclick="supprimerLien(this)">‚úï</button>
                        </td>
                    </tr>
                    <tr>
                        <td contenteditable="true"></td>
                        <td>
                            <button type="button" class="btn btn-small btn-primary" onclick="ouvrirFicheProjet(this)">
                                Fiche projet vierge
                            </button>
                            <button type="button" class="btn btn-small btn-danger" title="Supprimer le lien"
                                    onclick="supprimerLien(this)">‚úï</button>
                        </td>
                        <td>
                            <button type="button" class="btn btn-small btn-secondary" onclick="ouvrirInfoProjet(this)">
                                Info projet
                            </button>
                            <button type="button" class="btn btn-small btn-danger" title="Supprimer le lien"
                                    onclick="supprimerLien(this)">‚úï</button>
                        </td>
                        <td>
                            <button type="button" class="btn btn-small btn-ghost" onclick="ouvrirHistoriqueProjet(this)">
                                Historique
                            </button>
                            <button type="button" class="btn btn-small btn-danger" title="Supprimer le lien"
                                    onclick="supprimerLien(this)">‚úï</button>
                        </td>
                    </tr>
                    <tr>
                        <td contenteditable="true"></td>
                        <td>
                            <button type="button" class="btn btn-small btn-primary" onclick="ouvrirFicheProjet(this)">
                                Fiche projet vierge
                            </button>
                            <button type="button" class="btn btn-small btn-danger" title="Supprimer le lien"
                                    onclick="supprimerLien(this)">‚úï</button>
                        </td>
                        <td>
                            <button type="button" class="btn btn-small btn-secondary" onclick="ouvrirInfoProjet(this)">
                                Info projet
                            </button>
                            <button type="button" class="btn btn-small btn-danger" title="Supprimer le lien"
                                    onclick="supprimerLien(this)">‚úï</button>
                        </td>
                        <td>
                            <button type="button" class="btn btn-small btn-ghost" onclick="ouvrirHistoriqueProjet(this)">
                                Historique
                            </button>
                            <button type="button" class="btn btn-small btn-danger" title="Supprimer le lien"
                                    onclick="supprimerLien(this)">‚úï</button>
                        </td>
                    </tr>
                    <tr>
                        <td contenteditable="true"></td>
                        <td>
                            <button type="button" class="btn btn-small btn-primary" onclick="ouvrirFicheProjet(this)">
                                Fiche projet vierge
                            </button>
                            <button type="button" class="btn btn-small btn-danger" title="Supprimer le lien"
                                    onclick="supprimerLien(this)">‚úï</button>
                        </td>
                        <td>
                            <button type="button" class="btn btn-small btn-secondary" onclick="ouvrirInfoProjet(this)">
                                Info projet
                            </button>
                            <button type="button" class="btn btn-small btn-danger" title="Supprimer le lien"
                                    onclick="supprimerLien(this)">‚úï</button>
                        </td>
                        <td>
                            <button type="button" class="btn btn-small btn-ghost" onclick="ouvrirHistoriqueProjet(this)">
                                Historique
                            </button>
                            <button type="button" class="btn btn-small btn-danger" title="Supprimer le lien"
                                    onclick="supprimerLien(this)">‚úï</button>
                        </td>
                    </tr>
                    <tr>
                        <td contenteditable="true"></td>
                        <td>
                            <button type="button" class="btn btn-small btn-primary" onclick="ouvrirFicheProjet(this)">
                                Fiche projet vierge
                            </button>
                            <button type="button" class="btn btn-small btn-danger" title="Supprimer le lien"
                                    onclick="supprimerLien(this)">‚úï</button>
                        </td>
                        <td>
                            <button type="button" class="btn btn-small btn-secondary" onclick="ouvrirInfoProjet(this)">
                                Info projet
                            </button>
                            <button type="button" class="btn btn-small btn-danger" title="Supprimer le lien"
                                    onclick="supprimerLien(this)">‚úï</button>
                        </td>
                        <td>
                            <button type="button" class="btn btn-small btn-ghost" onclick="ouvrirHistoriqueProjet(this)">
                                Historique
                            </button>
                            <button type="button" class="btn btn-small btn-danger" title="Supprimer le lien"
                                    onclick="supprimerLien(this)">‚úï</button>
                        </td>
                    </tr>
                    <tr>
                        <td contenteditable="true"></td>
                        <td>
                            <button type="button" class="btn btn-small btn-primary" onclick="ouvrirFicheProjet(this)">
                                Fiche projet vierge
                            </button>
                            <button type="button" class="btn btn-small btn-danger" title="Supprimer le lien"
                                    onclick="supprimerLien(this)">‚úï</button>
                        </td>
                        <td>
                            <button type="button" class="btn btn-small btn-secondary" onclick="ouvrirInfoProjet(this)">
                                Info projet
                            </button>
                            <button type="button" class="btn btn-small btn-danger" title="Supprimer le lien"
                                    onclick="supprimerLien(this)">‚úï</button>
                        </td>
                        <td>
                            <button type="button" class="btn btn-small btn-ghost" onclick="ouvrirHistoriqueProjet(this)">
                                Historique
                            </button>
                            <button type="button" class="btn btn-small btn-danger" title="Supprimer le lien"
                                    onclick="supprimerLien(this)">‚úï</button>
                        </td>
                    </tr>
                    <tr>
                        <td contenteditable="true"></td>
                        <td>
                            <button type="button" class="btn btn-small btn-primary" onclick="ouvrirFicheProjet(this)">
                                Fiche projet vierge
                            </button>
                            <button type="button" class="btn btn-small btn-danger" title="Supprimer le lien"
                                    onclick="supprimerLien(this)">‚úï</button>
                        </td>
                        <td>
                            <button type="button" class="btn btn-small btn-secondary" onclick="ouvrirInfoProjet(this)">
                                Info projet
                            </button>
                            <button type="button" class="btn btn-small btn-danger" title="Supprimer le lien"
                                    onclick="supprimerLien(this)">‚úï</button>
                        </td>
                        <td>
                            <button type="button" class="btn btn-small btn-ghost" onclick="ouvrirHistoriqueProjet(this)">
                                Historique
                            </button>
                            <button type="button" class="btn btn-small btn-danger" title="Supprimer le lien"
                                    onclick="supprimerLien(this)">‚úï</button>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </section>

    <!-- PROJETS AEFE - PRINCIPAL -->
    <section id="aefe" class="page-section">
        <div class="card">
            <div class="section-header">
                <div>
                    <h2 class="page-title">
                        <span class="icon">üåê</span>
                        Projets AEFE
                    </h2>
                    <p class="intro-text">
                        Cette section recense les projets en lien avec les orientations du r√©seau AEFE. Elle permet d‚Äôidentifier les
                        projets structurants en lien avec l‚ÄôAgence.
                    </p>
                </div>
                <div class="badge">
                    <span>R√©seau AEFE</span>
                </div>
            </div>

            <div class="section-actions">
                <button type="button" class="btn btn-primary" onclick="afficherSection('aefe-liste')">
                    üìã Voir / saisir les projets AEFE
                </button>
            </div>

            <div class="section-actions">
                <button type="button" class="btn btn-secondary" onclick="afficherSection('accueil')">
                    üè† Retour √† l‚Äôaccueil
                </button>
            </div>
        </div>
    </section>

    <!-- PROJETS AEFE - LISTE -->
    <section id="aefe-liste" class="page-section">
        <div class="card">
            <div class="section-header">
                <div>
                    <h2 class="page-title">
                        <span class="icon">üìã</span>
                        Liste des projets AEFE
                    </h2>
                    <p class="intro-text">
                        Renseigne ici les projets AEFE (√©changes, dispositifs de formation, projets p√©dagogiques, etc.)
                        et associe pour chaque ligne une fiche projet vierge, une page d‚Äôinformation et un historique.
                    </p>
                </div>
            </div>

            <div class="toolbar">
                <button type="button" class="btn btn-primary" onclick="ajouterLigneGenerique('table-aefe')">
                    ‚ûï Ajouter une ligne
                </button>
                <button type="button" class="btn btn-secondary" onclick="afficherSection('aefe')">
                    ‚¨Ö Retour Projets AEFE
                </button>
                <button type="button" class="btn btn-ghost btn-small" onclick="afficherSection('accueil')">
                    üè† Retour √† l‚Äôaccueil
                </button>
            </div>

            <div class="table-wrapper">
                <table id="table-aefe">
                    <thead>
                    <tr>
                        <th>Intitul√© du projet AEFE</th>
                        <th>Fiche projet vierge</th>
                        <th>Info projet</th>
                        <th>Historique</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td contenteditable="true">Semaine des Lyc√©es Fran√ßais du Monde</td>
                        <td>
                            <button type="button" class="btn btn-small btn-primary" onclick="ouvrirFicheProjet(this)">
                                Fiche projet vierge
                            </button>
                            <button type="button" class="btn btn-small btn-danger" title="Supprimer le lien"
                                    onclick="supprimerLien(this)">‚úï</button>
                        </td>
                        <td>
                            <button type="button" class="btn btn-small btn-secondary"
                                    data-url="https://www.education.gouv.fr/semaine-des-lycees-francais-du-monde-"
                                    onclick="ouvrirInfoProjet(this)">
                                Info projet
                            </button>
                            <button type="button" class="btn btn-small btn-danger" title="Supprimer le lien"
                                    onclick="supprimerLien(this)">‚úï</button>
                        </td>
                        <td>
                            <button type="button" class="btn btn-small btn-ghost"
                                    data-url="https://drive.google.com/drive/folders/11r-cfJZtFelQRrJWhOGz5XwG9ecjVteV?usp=drive_link"
                                    onclick="ouvrirHistoriqueProjet(this)">
                                Historique
                            </button>
                            <button type="button" class="btn btn-small btn-danger" title="Supprimer le lien"
                                    onclick="supprimerLien(this)">‚úï</button>
                        </td>
                    </tr>
                    <tr>
                        <td contenteditable="true">L‚Äôintelligence artificielle ‚Äì projet annuel et transversal</td>
                        <td>
                            <button type="button" class="btn btn-small btn-primary" onclick="ouvrirFicheProjet(this)">
                                Fiche projet vierge
                            </button>
                            <button type="button" class="btn btn-small btn-danger" title="Supprimer le lien"
                                    onclick="supprimerLien(this)">‚úï</button>
                        </td>
                        <td>
                            <button type="button" class="btn btn-small btn-secondary"
                                    data-url="https://www.ac-paris.fr/l-intelligence-artificielle-dans-l-education-130992"
                                    onclick="ouvrirInfoProjet(this)">
                                Info projet
                            </button>
                            <button type="button" class="btn btn-small btn-danger" title="Supprimer le lien"
                                    onclick="supprimerLien(this)">‚úï</button>
                        </td>
                        <td>
                            <button type="button" class="btn btn-small btn-ghost"
                                    data-url="https://drive.google.com/drive/folders/1iedF0HDn976gbBh0xYpgmBwZiWOBXZRj?usp=drive_link"
                                    onclick="ouvrirHistoriqueProjet(this)">
                                Historique
                            </button>
                            <button type="button" class="btn btn-small btn-danger" title="Supprimer le lien"
                                    onclick="supprimerLien(this)">‚úï</button>
                        </td>
                    </tr>
                    <tr>
                        <td contenteditable="true">Club √©loquence ‚Äì concours AEH</td>
                        <td>
                            <button type="button" class="btn btn-small btn-primary" onclick="ouvrirFicheProjet(this)">
                                Fiche projet vierge
                            </button>
                            <button type="button" class="btn btn-small btn-danger" title="Supprimer le lien"
                                    onclick="supprimerLien(this)">‚úï</button>
                        </td>
                        <td>
                            <button type="button" class="btn btn-small btn-secondary"
                                    data-url="https://aefe.gouv.fr/fr/reseau-scolaire-mondial/des-projets-et-dispositifs-en-partage/dossier-ambassadeurs-ambassadrices-en-herbe"
                                    onclick="ouvrirInfoProjet(this)">
                                Info projet
                            </button>
                            <button type="button" class="btn btn-small btn-danger" title="Supprimer le lien"
                                    onclick="supprimerLien(this)">‚úï</button>
                        </td>
                        <td>
                            <button type="button" class="btn btn-small btn-ghost"
                                    data-url="https://drive.google.com/drive/folders/1pSAnmaSTUrJaoRdU19KxnsoBKJFa_oVh?usp=drive_link"
                                    onclick="ouvrirHistoriqueProjet(this)">
                                Historique
                            </button>
                            <button type="button" class="btn btn-small btn-danger" title="Supprimer le lien"
                                    onclick="supprimerLien(this)">‚úï</button>
                        </td>
                    </tr>
                    <tr>
                        <td contenteditable="true">Mai des langues</td>
                        <td>
                            <button type="button" class="btn btn-small btn-primary" onclick="ouvrirFicheProjet(this)">
                                Fiche projet vierge
                            </button>
                            <button type="button" class="btn btn-small btn-danger" title="Supprimer le lien"
                                    onclick="supprimerLien(this)">‚úï</button>
                        </td>
                        <td>
                            <button type="button" class="btn btn-small btn-secondary"
                                    data-url="https://www.egd.mg/le-mai-des-langues-2025/"
                                    onclick="ouvrirInfoProjet(this)">
                                Info projet
                            </button>
                            <button type="button" class="btn btn-small btn-danger" title="Supprimer le lien"
                                    onclick="supprimerLien(this)">‚úï</button>
                        </td>
                        <td>
                            <button type="button" class="btn btn-small btn-ghost"
                                    data-url="https://drive.google.com/drive/folders/1Z2SX_xVAnhiNLueOfCSGPdYHDv9izTIE?usp=drive_link"
                                    onclick="ouvrirHistoriqueProjet(this)">
                                Historique
                            </button>
                            <button type="button" class="btn btn-small btn-danger" title="Supprimer le lien"
                                    onclick="supprimerLien(this)">‚úï</button>
                        </td>
                    </tr>
                    <tr>
                        <td contenteditable="true">√âchange ADN ‚Äì AEFE</td>
                        <td>
                            <button type="button" class="btn btn-small btn-primary" onclick="ouvrirFicheProjet(this)">
                                Fiche projet vierge
                            </button>
                            <button type="button" class="btn btn-small btn-danger" title="Supprimer le lien"
                                    onclick="supprimerLien(this)">‚úï</button>
                        </td>
                        <td>
                            <button type="button" class="btn btn-small btn-secondary"
                                    data-url="https://www.egd.mg/adn-aefe/"
                                    onclick="ouvrirInfoProjet(this)">
                                Info projet
                            </button>
                            <button type="button" class="btn btn-small btn-danger" title="Supprimer le lien"
                                    onclick="supprimerLien(this)">‚úï</button>
                        </td>
                        <td>
                            <button type="button" class="btn btn-small btn-ghost"
                                    data-url="https://drive.google.com/drive/folders/1sCuxaq0eyRY8-ds2ijuNh4Xo0TofwJTn?usp=drive_link"
                                    onclick="ouvrirHistoriqueProjet(this)">
                                Historique
                            </button>
                            <button type="button" class="btn btn-small btn-danger" title="Supprimer le lien"
                                    onclick="supprimerLien(this)">‚úï</button>
                        </td>
                    </tr>
                    <tr>
                        <td contenteditable="true">Les Olympiades de la chimie</td>
                        <td>
                            <button type="button" class="btn btn-small btn-primary" onclick="ouvrirFicheProjet(this)">
                                Fiche projet vierge
                            </button>
                            <button type="button" class="btn btn-small btn-danger" title="Supprimer le lien"
                                    onclick="supprimerLien(this)">‚úï</button>
                        </td>
                        <td>
                            <button type="button" class="btn btn-small btn-secondary"
                                    data-url="https://www.olympiades-chimie.fr/"
                                    onclick="ouvrirInfoProjet(this)">
                                Info projet
                            </button>
                            <button type="button" class="btn btn-small btn-danger" title="Supprimer le lien"
                                    onclick="supprimerLien(this)">‚úï</button>
                        </td>
                        <td>
                            <button type="button" class="btn btn-small btn-ghost"
                                    data-url="https://drive.google.com/drive/folders/1RiMXGFZtTD"
                                    onclick="ouvrirHistoriqueProjet(this)">
                                Historique
                            </button>
                            <button type="button" class="btn btn-small btn-danger" title="Supprimer le lien"
                                    onclick="supprimerLien(this)">‚úï</button>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </section>

    <!-- PROJETS ZOI - PRINCIPAL -->
    <section id="zoi" class="page-section">
        <div class="card">
            <div class="section-header">
                <div>
                    <h2 class="page-title">
                        <span class="icon">üåä</span>
                        Projets Zone Oc√©an Indien
                    </h2>
                    <p class="intro-text">
                        Cette section regroupe les projets men√©s √† l‚Äô√©chelle de la zone Oc√©an Indien : coop√©rations inter-√©tablissements,
                        √©v√©nements de zone, mutualisation de ressources, etc.
                    </p>
                </div>
                <div class="badge">
                    <span>Coop√©rations de zone</span>
                </div>
            </div>

            <div class="section-actions">
                <button type="button" class="btn btn-primary" onclick="afficherSection('zoi-liste')">
                    üìã Voir / saisir les projets de la zone Oc√©an Indien
                </button>
            </div>

            <div class="section-actions">
                <button type="button" class="btn btn-secondary" onclick="afficherSection('accueil')">
                    üè† Retour √† l‚Äôaccueil
                </button>
            </div>
        </div>
    </section>

    <!-- PROJETS ZOI - LISTE -->
    <section id="zoi-liste" class="page-section">
        <div class="card">
            <div class="section-header">
                <div>
                    <h2 class="page-title">
                        <span class="icon">üìã</span>
                        Liste des projets Zone Oc√©an Indien
                    </h2>
                    <p class="intro-text">
                        Renseigne ici les projets de la zone Oc√©an Indien. En fin de ligne, tu peux associer une fiche projet,
                        une page d‚Äôinformation et un historique.
                    </p>
                </div>
            </div>

            <div class="toolbar">
                <button type="button" class="btn btn-primary" onclick="ajouterLigneGenerique('table-zoi')">
                    ‚ûï Ajouter une ligne
                </button>
                <button type="button" class="btn btn-secondary" onclick="afficherSection('zoi')">
                    ‚¨Ö Retour Projets Zone Oc√©an Indien
                </button>
                <button type="button" class="btn btn-ghost btn-small" onclick="afficherSection('accueil')">
                    üè† Retour √† l‚Äôaccueil
                </button>
            </div>

            <div class="table-wrapper">
                <table id="table-zoi">
                    <thead>
                    <tr>
                        <th>Intitul√© du projet Zone Oc√©an Indien</th>
                        <th>Fiche projet vierge</th>
                        <th>Info projet</th>
                        <th>Historique</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td contenteditable="true"></td>
                        <td>
                            <button type="button" class="btn btn-small btn-primary" onclick="ouvrirFicheProjet(this)">
                                Fiche projet vierge
                            </button>
                            <button type="button" class="btn btn-small btn-danger" title="Supprimer le lien"
                                    onclick="supprimerLien(this)">‚úï</button>
                        </td>
                        <td>
                            <button type="button" class="btn btn-small btn-secondary" onclick="ouvrirInfoProjet(this)">
                                Info projet
                            </button>
                            <button type="button" class="btn btn-small btn-danger" title="Supprimer le lien"
                                    onclick="supprimerLien(this)">‚úï</button>
                        </td>
                        <td>
                            <button type="button" class="btn btn-small btn-ghost" onclick="ouvrirHistoriqueProjet(this)">
                                Historique
                            </button>
                            <button type="button" class="btn btn-small btn-danger" title="Supprimer le lien"
                                    onclick="supprimerLien(this)">‚úï</button>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </section>

    <!-- PROJETS INSTITUTIONNELS - PRINCIPAL -->
    <section id="inst" class="page-section">
        <div class="card">
            <div class="section-header">
                <div>
                    <h2 class="page-title">
                        <span class="icon">üèõÔ∏è</span>
                        Projets institutionnels
                    </h2>
                    <p class="intro-text">
                        Cette section rassemble les projets inscrits dans le cadre institutionnel : axes du projet d‚Äô√©tablissement,
                        priorit√©s nationales, dispositifs officiels, etc.
                    </p>
                </div>
                <div class="badge">
                    <span>Cadre institutionnel</span>
                </div>
            </div>

            <div class="section-actions">
                <button type="button" class="btn btn-primary" onclick="afficherSection('inst-liste')">
                    üìã Voir / saisir les projets institutionnels
                </button>
            </div>

            <div class="section-actions">
                <button type="button" class="btn btn-secondary" onclick="afficherSection('accueil')">
                    üè† Retour √† l‚Äôaccueil
                </button>
            </div>
        </div>
    </section>

    <!-- PROJETS INSTITUTIONNELS - LISTE -->
    <section id="inst-liste" class="page-section">
        <div class="card">
            <div class="section-header">
                <div>
                    <h2 class="page-title">
                        <span class="icon">üìã</span>
                        Liste des projets institutionnels
                    </h2>
                    <p class="intro-text">
                        Renseigne ici les projets li√©s aux axes institutionnels (projet d‚Äô√©tablissement, priorit√©s nationales,
                        circulaires, etc.). En fin de ligne, tu peux associer la fiche projet, une page de r√©f√©rence et un historique.
                    </p>
                </div>
            </div>

            <div class="toolbar">
                <button type="button" class="btn btn-primary" onclick="ajouterLigneGenerique('table-inst')">
                    ‚ûï Ajouter une ligne
                </button>
                <button type="button" class="btn btn-secondary" onclick="afficherSection('inst')">
                    ‚¨Ö Retour Projets institutionnels
                </button>
                <button type="button" class="btn btn-ghost btn-small" onclick="afficherSection('accueil')">
                    üè† Retour √† l‚Äôaccueil
                </button>
            </div>

            <div class="table-wrapper">
                <table id="table-inst">
                    <thead>
                    <tr>
                        <th>Intitul√© du projet institutionnel</th>
                        <th>Fiche projet vierge</th>
                        <th>Info projet</th>
                        <th>Historique</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td contenteditable="true"></td>
                        <td>
                            <button type="button" class="btn btn-small btn-primary" onclick="ouvrirFicheProjet(this)">
                                Fiche projet vierge
                            </button>
                            <button type="button" class="btn btn-small btn-danger" title="Supprimer le lien"
                                    onclick="supprimerLien(this)">‚úï</button>
                        </td>
                        <td>
                            <button type="button" class="btn btn-small btn-secondary" onclick="ouvrirInfoProjet(this)">
                                Info projet
                            </button>
                            <button type="button" class="btn btn-small btn-danger" title="Supprimer le lien"
                                    onclick="supprimerLien(this)">‚úï</button>
                        </td>
                        <td>
                            <button type="button" class="btn btn-small btn-ghost" onclick="ouvrirHistoriqueProjet(this)">
                                Historique
                            </button>
                            <button type="button" class="btn btn-small btn-danger" title="Supprimer le lien"
                                    onclick="supprimerLien(this)">‚úï</button>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </section>

    <!-- PROJET D'√âTABLISSEMENT -->
    <section id="projet-etab" class="page-section">
        <div class="card">
            <div class="section-header">
                <div>
                    <h2 class="page-title">
                        <span class="icon">üìë</span>
                        Projet d'√©tablissement
                    </h2>
                    <p class="intro-text">
                        Cette page permet de pointer vers le projet d‚Äô√©tablissement (Genially, document PDF, page web‚Ä¶).
                        Le lien est param√©trable : colle simplement l‚ÄôURL lorsque tu cliques sur le bouton.
                    </p>
                </div>
                <div class="badge">
                    <span>R√©f√©rence strat√©gique</span>
                </div>
            </div>

            <div class="section-actions">
                <button type="button" class="btn btn-primary" onclick="ouvrirProjetEtab(this)">
                    üîó Ouvrir le projet d'√©tablissement
                </button>
                <button type="button" class="btn btn-small btn-danger" title="Supprimer le lien"
                        onclick="supprimerLien(this)">‚úï</button>
            </div>

            <div class="section-actions">
                <button type="button" class="btn btn-secondary" onclick="afficherSection('accueil')">
                    üè† Retour √† l‚Äôaccueil
                </button>
            </div>
        </div>
    </section>

    <!-- TUTO FICHE PROJET -->
    <section id="tuto-fiche" class="page-section">
        <div class="card">
            <div class="section-header">
                <div>
                    <h2 class="page-title">
                        <span class="icon">üéì</span>
                        Tuto fiche projet
                    </h2>
                    <p class="intro-text">
                        Cette page pointe vers un tutoriel expliquant comment remplir la fiche projet (vid√©o, Genially, diaporama‚Ä¶).
                        Le lien est param√©trable : colle simplement l‚ÄôURL lorsque tu cliques sur le bouton, ou utilise le tutoriel commun.
                    </p>
                </div>
                <div class="badge">
                    <span>Aide aux √©quipes</span>
                </div>
            </div>

            <div class="section-actions">
                <button type="button" class="btn btn-primary" onclick="ouvrirTutoFiche(this)">
                    üîó Ouvrir le tutoriel fiche projet
                </button>
                <button type="button" class="btn btn-small btn-danger" title="Supprimer le lien"
                        onclick="supprimerLien(this)">‚úï</button>
            </div>

            <div class="section-actions">
                <button type="button" class="btn btn-secondary" onclick="afficherSection('accueil')">
                    üè† Retour √† l‚Äôaccueil
                </button>
            </div>
        </div>
    </section>
</main>

<footer>
    <div class="footer-inner">
        <span>Outil de suivi des projets ‚Äì Lyc√©e fran√ßais de Tananarive ‚Äì Version param√©trable</span>
        <span>Les copies des fiches projets doivent √™tre rang√©es dans le dossier Drive d√©di√©.</span>
    </div>
</footer>

<script>

    /* =========================
       MODE PARTAG√â (Google Sheets + Apps Script)
       - Lecture pour tous
       - √âdition r√©serv√©e (mot de passe)
       ========================= */

    // 1) Colle ici l‚ÄôURL de TON Apps Script (Web app)
    const API_URL = "https://script.google.com/a/macros/egd.mg/s/AKfycbzP1wWe7oPpVjlRpQ6SAVb2FUUO-eP0aZt8PGKjwifHjCSbtFzLsU23Fm_QnjDk14v2MA/exec";

    // 2) Mot de passe d‚Äô√©dition (tu le d√©finis aussi c√¥t√© Apps Script)
    //    => ici on le stocke en session (sessionStorage) apr√®s saisie
    const EDIT_SESSION_KEY = "lft_editor_token";

    // Constantes de base (inchang√©es)
    const DOSSIER_PROJETS = "Projet LFT 2025-2026";
    const FICHE_PROJET_MODELE = "https://docs.google.com/document/d/1a8Evjzr_magbpTciki4jUDmfW2vaps5Q/copy";
    const TUTO_FICHE_URL = "https://docs.google.com/document/d/1BUJrKIsRKqykSBhYusvjEYfEA5UyXgfc/edit?usp=drive_link&ouid=103402101997126526626&rtpof=true&sd=true";

    // Correspondance "intitul√© projet AEFE" -> URL info (inchang√©)
    const INFO_PROJET_DEFAULTS = {
        "semaine des lyc√©es fran√ßais du monde": "https://www.education.gouv.fr/semaine-des-lycees-francais-du-monde-",
        "l‚Äôintelligence artificielle ‚Äì projet annuel et transversal": "https://www.ac-paris.fr/l-intelligence-artificielle-dans-l-education-130992",
        "l'intelligence artificielle ‚Äì projet annuel et transversal": "https://www.ac-paris.fr/l-intelligence-artificielle-dans-l-education-130992",
        "club √©loquence ‚Äì concours aeh": "https://aefe.gouv.fr/fr/reseau-scolaire-mondial/des-projets-et-dispositifs-en-partage/dossier-ambassadeurs-ambassadrices-en-herbe",
        "club eloquence ‚Äì concours aeh": "https://aefe.gouv.fr/fr/reseau-scolaire-mondial/des-projets-et-dispositifs-en-partage/dossier-ambassadeurs-ambassadrices-en-herbe",
        "mai des langues": "https://www.egd.mg/le-mai-des-langues-2025/",
        "√©change adn ‚Äì aefe": "https://www.egd.mg/adn-aefe/",
        "echange adn ‚Äì aefe": "https://www.egd.mg/adn-aefe/",
        "les olympiades de la chimie": "https://www.olympiades-chimie.fr/"
    };

    let moisCourant = null;
    const donneesMois = {};

    /* ---------- UI : bandeau "Lecture / √âdition" ---------- */
    const ui = {
        isEditor: false,
        saving: false,
        saveTimer: null,
        lastLoadedHash: null
    };

    function getEditorToken() {
        return sessionStorage.getItem(EDIT_SESSION_KEY) || "";
    }

    function setEditorToken(token) {
        if (token) sessionStorage.setItem(EDIT_SESSION_KEY, token);
        else sessionStorage.removeItem(EDIT_SESSION_KEY);
    }

    function ensureModeBar() {
        if (document.getElementById("modeBar")) return;

        const bar = document.createElement("div");
        bar.id = "modeBar";
        bar.style.cssText = `
          position: sticky; top: 0; z-index: 9999;
          background: rgba(15,23,42,0.92);
          color: #e5e7eb;
          padding: 0.55rem 0.9rem;
          font-size: 0.85rem;
          display: flex; gap: 0.6rem; align-items: center; justify-content: space-between;
          backdrop-filter: blur(8px);
        `;

        bar.innerHTML = `
          <div style="display:flex;gap:.6rem;align-items:center;flex-wrap:wrap;">
            <strong>Suivi partag√©</strong>
            <span id="modeBadge" style="padding:.15rem .55rem;border-radius:999px;background:#334155;">Lecture</span>
            <span id="saveBadge" style="opacity:.85;"></span>
          </div>
          <div style="display:flex;gap:.5rem;align-items:center;flex-wrap:wrap;">
            <button id="btnEditMode" style="border:none;border-radius:999px;padding:.35rem .75rem;cursor:pointer;">Passer en √©dition</button>
            <button id="btnRefresh" style="border:none;border-radius:999px;padding:.35rem .75rem;cursor:pointer;">Actualiser</button>
            <button id="btnLogout" style="border:none;border-radius:999px;padding:.35rem .75rem;cursor:pointer;display:none;">Quitter √©dition</button>
          </div>
        `;

        document.body.insertBefore(bar, document.body.firstChild);

        document.getElementById("btnEditMode").addEventListener("click", async () => {
            const token = prompt("Mot de passe d‚Äô√©dition (r√©serv√©) :");
            if (!token) return;
            setEditorToken(token);
            // on teste une √©criture √† blanc (ping)
            try {
                await apiSetState(collectState(), true);
                ui.isEditor = true;
                applyReadOnly(false);
                updateModeBar();
                alert("‚úÖ Mode √©dition activ√©.");
            } catch (e) {
                setEditorToken("");
                ui.isEditor = false;
                applyReadOnly(true);
                updateModeBar();
                alert("‚ùå Mot de passe incorrect ou API non configur√©e.

D√©tail: " + e.message);
            }
        });

        document.getElementById("btnLogout").addEventListener("click", () => {
            setEditorToken("");
            ui.isEditor = false;
            applyReadOnly(true);
            updateModeBar();
        });

        document.getElementById("btnRefresh").addEventListener("click", async () => {
            await loadSharedState(true);
        });

        updateModeBar();
    }

    function updateModeBar() {
        const badge = document.getElementById("modeBadge");
        const saveBadge = document.getElementById("saveBadge");
        const btnEdit = document.getElementById("btnEditMode");
        const btnLogout = document.getElementById("btnLogout");

        if (!badge) return;
        if (ui.isEditor) {
            badge.textContent = "√âdition";
            badge.style.background = "#16a34a";
            btnEdit.style.display = "none";
            btnLogout.style.display = "inline-block";
        } else {
            badge.textContent = "Lecture";
            badge.style.background = "#334155";
            btnEdit.style.display = "inline-block";
            btnLogout.style.display = "none";
        }

        if (ui.saving) saveBadge.textContent = "‚è≥ Sauvegarde‚Ä¶";
        else saveBadge.textContent = "";
    }

    function applyReadOnly(readOnly) {
        // contenteditable
        document.querySelectorAll('[contenteditable="true"]').forEach(el => {
            el.setAttribute("contenteditable", readOnly ? "false" : "true");
            if (readOnly) el.style.outline = "none";
        });

        // Boutons d‚Äôajout de lignes
        document.querySelectorAll('button').forEach(btn => {
            const txt = (btn.textContent || "").trim();
            if (txt.includes("Ajouter une ligne") || txt.startsWith("‚ûï")) {
                btn.style.display = readOnly ? "none" : "";
            }
        });

        // Petits boutons ‚úï (suppression liens)
        document.querySelectorAll('.btn-danger').forEach(btn => {
            btn.style.display = readOnly ? "none" : "";
        });
    }

    /* ---------- Navigation entre sections (inchang√©e, mais on planifie la sauvegarde) ---------- */
    function afficherSection(id) {
        const sections = document.querySelectorAll('.page-section');
        const moisDetail = document.getElementById('mois-detail');
        if (moisDetail && moisDetail.classList.contains('active')) {
            sauvegarderMoisCourant();
        }
        sections.forEach(sec => sec.classList.remove('active'));
        const cible = document.getElementById(id);
        if (cible) {
            cible.classList.add('active');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    }

    // Sauvegarde du mois courant (table "projets du mois")
    function sauvegarderMoisCourant() {
        if (!moisCourant) return;
        const tbody = document.querySelector('#table-mois-detail tbody');
        if (!tbody) return;
        donneesMois[moisCourant] = tbody.innerHTML;
    }

    // Ouvrir un mois donn√©
    function ouvrirMois(mois) {
        sauvegarderMoisCourant();
        moisCourant = mois;
        document.getElementById('moisTitre').textContent = mois;
        const table = document.getElementById('table-mois-detail');
        const tbody = table.querySelector('tbody');
        if (donneesMois[mois]) {
            tbody.innerHTML = donneesMois[mois];
        } else {
            tbody.innerHTML = '';
            const row = document.createElement('tr');
            const cell = document.createElement('td');
            cell.setAttribute('contenteditable', ui.isEditor ? 'true' : 'false');
            row.appendChild(cell);
            tbody.appendChild(row);
        }
        afficherSection('mois-detail');
    }

    // Ajouter une ligne dans le tableau "projets du mois"
    function ajouterLigneMoisDetail() {
        if (!ui.isEditor) return alert("Lecture seule : passe en mode √©dition pour modifier.");
        const table = document.getElementById('table-mois-detail');
        const tbody = table.querySelector('tbody');
        const templateRow = tbody.rows[0];
        const newRow = templateRow.cloneNode(true);
        newRow.cells[0].textContent = '';
        newRow.cells[0].setAttribute('contenteditable','true');
        tbody.appendChild(newRow);
        scheduleSave();
    }

    // Ajouter une ligne g√©n√©rique
    function ajouterLigneGenerique(tableId) {
        if (!ui.isEditor) return alert("Lecture seule : passe en mode √©dition pour modifier.");
        const table = document.getElementById(tableId);
        if (!table) return;
        const tbody = table.querySelector('tbody');
        const templateRow = tbody.rows[0];
        const newRow = templateRow.cloneNode(true);
        Array.from(newRow.cells).forEach(cell => {
            const buttons = cell.querySelectorAll('button');
            if (buttons.length) {
                buttons.forEach(btn => btn.removeAttribute('data-url'));
            } else if (cell.hasAttribute('contenteditable')) {
                cell.textContent = '';
                cell.setAttribute('contenteditable','true');
            }
        });
        tbody.appendChild(newRow);
        scheduleSave();
    }

    // Transforme un lien Google Docs en /copy si besoin
    function transformerLienTemplate(url) {
        try {
            const u = new URL(url);
            if (u.hostname.includes("docs.google.com")) {
                if (u.pathname.endsWith("/copy") || u.pathname.includes("/template")) return u.toString();
                if (u.pathname.includes("/edit")) {
                    const base = u.origin + u.pathname.split("/edit")[0];
                    return base + "/copy";
                }
                return u.origin + u.pathname.replace(/\/$/, "") + "/copy";
            }
        } catch (e) {}
        return url;
    }

    // Boutons de liens : en lecture seule, on ouvre uniquement si data-url existe
    function ouvrirFicheProjet(btn) {
        let url = btn.getAttribute('data-url');
        if (!url) url = FICHE_PROJET_MODELE;

        if (!ui.isEditor && !btn.getAttribute('data-url')) {
            // lecture seule : on ouvre le mod√®le sans enregistrer de lien perso
            window.open(transformerLienTemplate(url), '_blank');
            return;
        }

        if (!ui.isEditor) return alert("Lecture seule : passe en mode √©dition pour modifier les liens.");

        if (!url) {
            url = prompt("Saisir ou coller le lien de la fiche projet vierge (Google Docs, Drive, etc.) :");
            if (!url) return;
        }
        const finalUrl = transformerLienTemplate(url);
        btn.setAttribute('data-url', finalUrl);
        scheduleSave();
        window.open(finalUrl, '_blank');
        setTimeout(() => {
            alert("La copie de la fiche projet vient d‚Äô√™tre cr√©√©e dans ton Drive.

Pense √† la d√©placer dans le dossier :

¬´ " + DOSSIER_PROJETS + " ¬ª.");
        }, 800);
    }

    function ouvrirInfoProjet(btn) {
        let url = btn.getAttribute('data-url');

        if (!url) {
            const row = btn.closest('tr');
            if (row && row.cells.length > 0) {
                const titre = row.cells[0].textContent.trim().toLowerCase();
                if (INFO_PROJET_DEFAULTS[titre]) {
                    url = INFO_PROJET_DEFAULTS[titre];
                    if (ui.isEditor) btn.setAttribute('data-url', url);
                }
            }
        }

        if (!url) {
            if (!ui.isEditor) return alert("Aucun lien d√©fini (lecture seule).");
            url = prompt("Saisir ou coller le lien d‚Äôinformation sur ce projet (page web explicative) :");
            if (!url) return;
            btn.setAttribute('data-url', url);
        }

        if (ui.isEditor) scheduleSave();
        window.open(url, '_blank');
    }

    function ouvrirHistoriqueProjet(btn) {
        let url = btn.getAttribute('data-url');
        if (!url) {
            if (!ui.isEditor) return alert("Aucun lien d√©fini (lecture seule).");
            url = prompt("Saisir ou coller le lien vers l‚Äôhistorique de ce projet (dossier Drive, pad, document, etc.) :");
            if (!url) return;
            btn.setAttribute('data-url', url);
            scheduleSave();
        }
        window.open(url, '_blank');
    }

    function ouvrirProjetEtab(btn) {
        let url = btn.getAttribute('data-url');
        if (!url) {
            if (!ui.isEditor) return alert("Aucun lien d√©fini (lecture seule).");
            url = prompt("Saisir ou coller le lien vers le projet d'√©tablissement (Genially, document, etc.) :");
            if (!url) return;
            btn.setAttribute('data-url', url);
            scheduleSave();
        }
        window.open(url, '_blank');
    }

    function ouvrirTutoFiche(btn) {
        let url = btn.getAttribute('data-url');
        if (!url) url = TUTO_FICHE_URL;

        if (!url) {
            if (!ui.isEditor) return alert("Aucun lien d√©fini (lecture seule).");
            url = prompt("Saisir ou coller le lien vers le tutoriel (vid√©o, Genially, document, etc.) :");
            if (!url) return;
        }

        if (ui.isEditor) {
            btn.setAttribute('data-url', url);
            scheduleSave();
        }
        window.open(url, '_blank');
    }

    function supprimerLien(xButton) {
        if (!ui.isEditor) return alert("Lecture seule : passe en mode √©dition pour modifier.");
        const confirmation = confirm("Voulez-vous supprimer le lien ?");
        if (!confirmation) return;
        const cell = xButton.parentElement;
        if (!cell) return;
        const buttons = cell.querySelectorAll('button');
        buttons.forEach(btn => { if (btn !== xButton) btn.removeAttribute('data-url'); });
        scheduleSave();
        alert("Le lien a √©t√© supprim√© pour ce bouton.");
    }

    /* =========================
       SAUVEGARDE PARTAG√âE (API)
       ========================= */

    function collectState() {
        // Sauvegarder le mois courant
        sauvegarderMoisCourant();

        const tableIds = ['table-aefe', 'table-zoi', 'table-lft', 'table-inst'];
        const tableData = {};
        tableIds.forEach(id => {
            const table = document.getElementById(id);
            if (table) {
                const tbody = table.querySelector('tbody');
                if (tbody) tableData[id] = tbody.innerHTML;
            }
        });

        const linksData = {};
        const btnProjet = document.querySelector('#projet-etab .btn-primary');
        if (btnProjet) {
            const u = btnProjet.getAttribute('data-url');
            if (u) linksData.projetEtab = u;
        }
        const btnTuto = document.querySelector('#tuto-fiche .btn-primary');
        if (btnTuto) {
            const u2 = btnTuto.getAttribute('data-url');
            if (u2) linksData.tutoFiche = u2;
        }

        return {
            version: 1,
            mois: donneesMois,
            tables: tableData,
            links: linksData,
            updatedAt: new Date().toISOString()
        };
    }

    function applyState(state) {
        if (!state || typeof state !== "object") return;

        // mois
        if (state.mois && typeof state.mois === "object") {
            Object.keys(donneesMois).forEach(k => delete donneesMois[k]);
            Object.assign(donneesMois, state.mois);
        }

        // tables
        if (state.tables && typeof state.tables === "object") {
            Object.keys(state.tables).forEach(id => {
                const table = document.getElementById(id);
                if (table) {
                    const tbody = table.querySelector('tbody');
                    if (tbody) tbody.innerHTML = state.tables[id];
                }
            });
        }

        // links
        if (state.links && typeof state.links === "object") {
            const btnProjet = document.querySelector('#projet-etab .btn-primary');
            if (btnProjet && state.links.projetEtab) btnProjet.setAttribute('data-url', state.links.projetEtab);
            const btnTuto = document.querySelector('#tuto-fiche .btn-primary');
            if (btnTuto && state.links.tutoFiche) btnTuto.setAttribute('data-url', state.links.tutoFiche);
        }

        // appliquer le mode readonly/edition sur le DOM courant
        applyReadOnly(!ui.isEditor);
    }

    function stableHash(obj) {
        // hash simple pour √©viter d‚Äô√©craser un √©tat identique
        const s = JSON.stringify(obj);
        let h = 0;
        for (let i = 0; i < s.length; i++) h = (h * 31 + s.charCodeAt(i)) >>> 0;
        return String(h);
    }

    async function apiGetState() {
        const r = await fetch(API_URL, { cache: "no-store" });
        const j = await r.json();
        if (!j.ok) throw new Error(j.error || "Erreur API (GET)");
        return j.state || null;
    }

    async function apiSetState(state, isPing=false) {
        const token = getEditorToken();
        const r = await fetch(API_URL, {
            method: "POST",
            headers: { "Content-Type": "text/plain;charset=utf-8" },
            body: JSON.stringify({ action: "set", token, state, ping: !!isPing })
        });
        const j = await r.json();
        if (!j.ok) throw new Error(j.error || "Erreur API (POST)");
        return j;
    }

    function scheduleSave() {
        if (!ui.isEditor) return;
        if (ui.saveTimer) clearTimeout(ui.saveTimer);
        ui.saveTimer = setTimeout(async () => {
            try {
                ui.saving = true; updateModeBar();
                const state = collectState();
                const h = stableHash(state);
                if (h === ui.lastLoadedHash) { ui.saving = false; updateModeBar(); return; }
                await apiSetState(state);
                ui.lastLoadedHash = h;
            } catch (e) {
                console.error(e);
                alert("Erreur de sauvegarde partag√©e : " + e.message);
            } finally {
                ui.saving = false; updateModeBar();
            }
        }, 600);
    }

    async function loadSharedState(force=false) {
        try {
            const state = await apiGetState();
            if (!state) return;
            const h = stableHash(state);
            if (!force && ui.lastLoadedHash === h) return;

            ui.lastLoadedHash = h;
            applyState(state);
        } catch (e) {
            console.warn("Impossible de charger l‚Äô√©tat partag√© :", e);
        }
    }

    function attachAutoSaveListeners() {
        // En √©dition : sauvegarder quand l‚Äôutilisateur modifie du contenu
        document.addEventListener("input", (e) => {
            if (!ui.isEditor) return;
            const t = e.target;
            if (t && t.closest && t.closest("td") && t.closest("td").getAttribute("contenteditable") === "true") {
                scheduleSave();
            }
        }, true);

        // Sauvegarde lors de sortie de cellule (blur)
        document.addEventListener("blur", (e) => {
            if (!ui.isEditor) return;
            const t = e.target;
            if (t && t.getAttribute && t.getAttribute("contenteditable") === "true") scheduleSave();
        }, true);
    }

    /* ---------- D√©marrage ---------- */
    document.addEventListener("DOMContentLoaded", async () => {
  try {
    ensureModeBar();

    // Mode par d√©faut : lecture
    ui.isEditor = false;
    applyReadOnly(true);

    attachAutoSaveListeners();

    // Charger l‚Äô√©tat partag√© au d√©marrage
    await loadSharedState(true);

    // Rafra√Æchissement auto toutes les 30s en lecture
    setInterval(() => {
      if (!ui.isEditor) loadSharedState(false);
    }, 30000);

  } catch (e) {
    console.error("Erreur initShared :", e);
    alert("Erreur de chargement du suivi partag√©.\nOuvre la console (F12) pour d√©tails.");
  }
});

        ensureModeBar();

        // Mode par d√©faut : lecture
        ui.isEditor = false;
        applyReadOnly(true);

        attachAutoSaveListeners();

        // Charger l‚Äô√©tat partag√© au d√©marrage
        await loadSharedState(true);

        // Rafra√Æchir automatiquement toutes les 30 secondes en lecture
        setInterval(() => {
            if (!ui.isEditor) loadSharedState(false);
        }, 30000);
    })();

</script>
</body>
</html>

